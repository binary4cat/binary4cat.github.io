<!DOCTYPE html>



 <html class="no-js"> 
<head>
    <title>å­˜å‚¨è¿‡ç¨‹  &middot; Haijd&#39;s Blog </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="content-language" content="en-us" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Haijd">
    <meta name="description" content="a coder.">
    <meta name="generator" content="Hugo 0.53" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/smooth-scrollbar.css" />
    <link rel="stylesheet" type="text/css" href="/css/main.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/tomorrow.min.css" />
    

    <style>
        .posts li {
            visibility: hidden;
        }
    </style> 
</head>

<body>

    

    <header>
    <div class="h-wrap">
        
        <div class="typewriter">
            <h1 class="title"><a href="/">Haijd&#39;s Blog</a></h1>
        </div>
        
    </div>
</header>
    <div class="site-wrapper" id="full-wrapper">

        <section class="single-wrap">
            <article class="single-content" itemscope itemtype="//schema.org/BlogPosting">
                <div class="feat">
                    <h5 class="page-date">
                        <time datetime="" itemprop="datePublished">
                    26 March 2015
                   
                    </time>
                    </h5>
                </div>
                <h1 class="page-title" itemprop="name headline">å­˜å‚¨è¿‡ç¨‹</h1>
                <br>
                
                <div>
                    
                    <img src="http://lorempixel.com/1000/500/technics/">
                    
                </div>
                
                <div>
                    <nav id="TableOfContents">
<ul>
<li><a href="#1-ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹">1. ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹</a></li>
<li><a href="#2-å­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç‚¹">2. å­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç‚¹</a></li>
<li><a href="#3-å­˜å‚¨è¿‡ç¨‹çš„ç§ç±»">3. å­˜å‚¨è¿‡ç¨‹çš„ç§ç±»</a></li>
<li><a href="#4-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹">4. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</a>
<ul>
<li><a href="#4-1-ä»£ç ç¤ºä¾‹">4.1. ä»£ç ç¤ºä¾‹ï¼š</a></li>
</ul></li>
</ul>
</nav>
                </div>
                <hr>
                <div itemprop="articleBody">
                    <h1 id="1-ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹">1. ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹</h1>

<p>ã€€ã€€è°ƒç”¨<a href="http://baike.baidu.com/link?url=c2abUFqhD2LK7x4of_AqDRsR9zA_O8N7DSr-IK1oY_7C8_0OxNX-3mVmBfbPpYo5yhMm8nUGydsNQV0NJ73EL_">ç™¾åº¦ç™¾ç§‘</a>çš„è§£é‡Š:å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯åœ¨å¤§å‹æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQL è¯­å¥é›†ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç»è¿‡ç¬¬ä¸€æ¬¡ç¼–è¯‘åå†æ¬¡è°ƒç”¨ä¸éœ€è¦å†æ¬¡ç¼–è¯‘ï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥æ‰§è¡Œå®ƒã€‚å­˜å‚¨è¿‡ç¨‹æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªé‡è¦å¯¹è±¡ï¼Œä»»ä½•ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„æ•°æ®åº“åº”ç”¨ç¨‹åºéƒ½åº”è¯¥ç”¨åˆ°å­˜å‚¨è¿‡ç¨‹ã€‚
ã€€ã€€ç®€å•æ¥è¯´ï¼Œå­˜å‚¨è¿‡ç¨‹å°±åƒæ˜¯c#ä¸­çš„<strong>æ–¹æ³•</strong>ï¼Œè¯¥æ–¹æ³•å®ç°æŸä¸€ç‰¹å®šçš„åŠŸèƒ½ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥è°ƒç”¨å°±è¡Œäº†ã€‚è€Œä¸”è¯¥æ–¹æ³•è¿˜æ˜¯å•ä¾‹çš„ã€‚
ã€€ã€€å­˜å‚¨è¿‡ç¨‹ä¸ä»…ä»…æ˜¯ä¸€ç»„SQLè¯­å¥çš„ç»„åˆï¼Œå­˜å‚¨è¿‡ç¨‹å’Œä¸€èˆ¬çš„SQLè¯­å¥è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚
ã€€ã€€</p>

<p>å½“æˆ‘ä»¬ä½¿ç”¨SQL Serveræ•°æ®åº“å¸®åŠ©æˆ‘ä»¬å»ºç«‹ç½‘ç«™æˆ–åº”ç”¨è½¯ä»¶æ—¶ï¼ŒTransaction-SQLæ˜¯ä¸€ç§ä¸»è¦çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½¿ç”¨SQLè¯­å¥(Transaction-SQL)ç¼–ç¨‹æœ‰ä¸¤ç§æ–¹æ³•ï¼š
ã€€ã€€â‘  åœ¨æœ¬åœ°å­˜å‚¨SQLè¯­å¥ç¼–å†™çš„ä»£ç ï¼Œé€šè¿‡ç¨‹åºè¿æ¥æ•°æ®åº“ï¼Œå¯¹SQL Serverè¿›è¡Œæ“ä½œã€‚
ã€€ã€€â‘¡ æŠŠéƒ¨åˆ†å¤æ‚æˆ–é‡ç”¨çš„SQLè¯­å¥å°è£…æˆå­˜å‚¨è¿‡ç¨‹ï¼Œå­˜å‚¨åœ¨SQL Serveræ•°æ®åº“ä¸­ï¼Œç„¶åé€šè¿‡ç¨‹åºå»è°ƒç”¨å­˜å‚¨è¿‡ç¨‹å³å¯ã€‚è€Œä¸”è¿˜å¯ä»¥åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ã€‚</p>

<h1 id="2-å­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç‚¹">2. å­˜å‚¨è¿‡ç¨‹çš„ä¼˜ç‚¹</h1>

<p>ã€€ã€€1.å­˜å‚¨è¿‡ç¨‹åªåœ¨åˆ›å»ºæ—¶è¿›è¡Œç¼–è¯‘ï¼Œä»¥åæ¯æ¬¡æ‰§è¡Œéƒ½ä¸éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œè€Œä¸€èˆ¬SQLè¯­å¥æ¯æ‰§è¡Œä¸€æ¬¡å°±ç¼–è¯‘ä¸€æ¬¡ï¼Œæ‰€ä»¥å­˜å‚¨è¿‡ç¨‹å¯ä»¥æé«˜æ•°æ®åº“çš„æ‰§è¡Œé€Ÿåº¦ã€‚
ã€€ã€€2.å¯¹æ•°æ®åº“è¿›è¡Œå¤æ‚æ“ä½œæ—¶(æ¯”å¦‚å¯¹å¤šå¼ è¡¨è¿›è¡ŒSELECTã€INSERTã€UPDATEã€DELETE)ï¼Œå¯å°†æ­¤å¤æ‚æ“ä½œå°è£…æˆå­˜å‚¨è¿‡ç¨‹ï¼Œç„¶åç»“åˆæ•°æ®åº“ä¸­çš„äº‹ç‰©å¤„ç†ä¸€èµ·ä½¿ç”¨ã€‚
ã€€ã€€3.å­˜å‚¨è¿‡ç¨‹å¯ä»¥å¤ç”¨ï¼Œä»è€Œå‡å°‘å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚
ã€€ã€€4.å®‰å…¨æ€§é«˜ï¼Œå¯ä»¥è®¾å®šæ“ä½œæ­¤å­˜å‚¨è¿‡ç¨‹çš„ç”¨æˆ·æƒé™ã€‚
ã€€ã€€5.ä½¿ç”¨æ—¶åªéœ€è¦ä¼ è¾“è°ƒç”¨è¯­å¥ï¼Œè€Œéå¤šæ¡SQLè¯­å¥ï¼Œå‡å°‘ç½‘ç»œæµé‡ï¼Œé™ä½ç½‘ç»œè´Ÿè½½ã€‚</p>

<h1 id="3-å­˜å‚¨è¿‡ç¨‹çš„ç§ç±»">3. å­˜å‚¨è¿‡ç¨‹çš„ç§ç±»</h1>

<p>ã€€ã€€1.ç³»ç»Ÿå­˜å‚¨è¿‡ç¨‹ï¼šä»¥<code>SP_</code>å¼€å¤´ï¼Œç”¨æ¥è¿›è¡Œç³»ç»Ÿçš„å„é¡¹è®¾å®šã€å–å¾—ä¿¡æ¯ã€ç›¸å…³ç®¡ç†ï¼Œæ¯”å¦‚<code>SP_help</code>å°±æ˜¯å–å¾—æŒ‡å®šå¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ã€‚
ã€€ã€€2.æ‰©å±•å­˜å‚¨è¿‡ç¨‹ï¼šä»¥<code>XP_</code>å¼€å¤´ï¼Œç”¨æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„åŠŸèƒ½ï¼Œ<code>exec master ..XP_cmdshell 'ping 120.110.119:12306'</code>
ã€€ã€€3.ç”¨æˆ·è‡ªå®šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¿™ç¯‡åšå®¢æ‰€è¯´çš„å­˜å‚¨è¿‡ç¨‹ã€‚</p>

<h1 id="4-åˆ›å»ºå­˜å‚¨è¿‡ç¨‹">4. åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h1>

<p>åˆ›å»ºè¯­æ³•ï¼š
ã€€ã€€create proc usp_name
ã€€ã€€å½¢å‚åˆ—è¡¨(å½¢å‚åç§°ä»¥@ç¬¦å·å¼€å¤´ï¼Œå‚æ•°ç±»å‹åœ¨å)
ã€€ã€€as
ã€€ã€€  æ–¹æ³•ä½“
ã€€ã€€go</p>

<p>è°ƒç”¨è¯­æ³•ï¼š
ã€€ã€€exec å­˜å‚¨è¿‡ç¨‹åç§° å®å‚,å®å‚,å®å‚&hellip;</p>

<p>ã€€ã€€<text style="color:red">åœ¨è°ƒç”¨çš„æ—¶å€™è¦ä¸‰ä¸ªå¯¹åº”ï¼šç±»å‹å¯¹åº”ã€æ•°é‡å¯¹åº”ã€é¡ºåºå¯¹åº”ã€‚<text/></p>

<h2 id="4-1-ä»£ç ç¤ºä¾‹">4.1. ä»£ç ç¤ºä¾‹ï¼š</h2>

<p><strong>è·å–æ‰€æœ‰å‘˜å·¥ä¿¡æ¯</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">go</span>
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">exists</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> sysobjects <span style="color:#ff79c6">where</span> name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;usp_getAllStaffInfo&#39;</span>)
    <span style="color:#ff79c6">drop</span> proc usp_getAllStaffInfo
<span style="color:#ff79c6">go</span>

<span style="color:#ff79c6">create</span> <span style="color:#ff79c6">procedure</span> usp_getAllStuInfo
<span style="color:#ff79c6">as</span>
    <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> Staff
<span style="color:#ff79c6">go</span>

<span style="color:#6272a4">--è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">execute</span> usp_getAllStaffInfo</code></pre></td></tr></table>
</div>
</div>
<p><strong>æŸ¥è¯¢æŒ‡å®šæ€§åˆ«çš„å‘˜å·¥ä¿¡æ¯</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">go</span>
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">exists</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> sysobjects <span style="color:#ff79c6">where</span> name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;usp_GetStaffInfoBySex&#39;</span>)
    <span style="color:#ff79c6">drop</span> proc usp_GetStaffInfoBySex
<span style="color:#ff79c6">go</span>

<span style="color:#ff79c6">create</span> PROC usp_GetStaffInfoBySex
<span style="color:#ff79c6">@</span>sex <span style="color:#ff79c6">nchar</span>(<span style="color:#bd93f9">1</span>)   
<span style="color:#ff79c6">as</span>
    <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> Staff <span style="color:#ff79c6">where</span> Sex<span style="color:#ff79c6">=@</span>sex
<span style="color:#ff79c6">go</span>

<span style="color:#6272a4">--è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">EXEC</span> usp_GetStaffInfoBySex <span style="color:#f1fa8c">&#39;ç”·&#39;</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>è·å–æŒ‡å®šéƒ¨é—¨å’Œæ€§åˆ«çš„å‘˜å·¥ä¿¡æ¯</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">go</span>
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">exists</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> sysobjects <span style="color:#ff79c6">where</span> name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;usp_GetStaffInfoBySexForClass&#39;</span>)
    <span style="color:#ff79c6">drop</span> PROC usp_GetStaffInfoBySexForClass
<span style="color:#ff79c6">go</span>

<span style="color:#ff79c6">create</span> PROC usp_GetStaffInfoBySexForClass
<span style="color:#ff79c6">@</span>className nvarchar(<span style="color:#bd93f9">20</span>)
<span style="color:#ff79c6">@</span>sex ncahr(<span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;ç”·&#39;</span>   <span style="color:#6272a4">--æœ‰é»˜è®¤å€¼çš„å½¢å‚
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">as</span>
    <span style="color:#ff79c6">declare</span> <span style="color:#ff79c6">@</span>classId <span style="color:#8be9fd;font-style:italic">int</span>   <span style="color:#6272a4">--å£°æ˜ä¸€ä¸ªå­˜å‚¨éƒ¨é—¨IDçš„å˜é‡
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">set</span> <span style="color:#ff79c6">@</span>classId<span style="color:#ff79c6">=</span>(<span style="color:#ff79c6">select</span> classId <span style="color:#ff79c6">from</span> Company <span style="color:#ff79c6">where</span> className<span style="color:#ff79c6">=@</span>className)
    <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> Staff <span style="color:#ff79c6">where</span> Sex<span style="color:#ff79c6">=@</span>sex <span style="color:#ff79c6">and</span> classId<span style="color:#ff79c6">=@</span>classId
<span style="color:#ff79c6">go</span>

<span style="color:#6272a4">--è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">EXEC</span> usp_GetStaffInfoBySexForClass <span style="color:#ff79c6">@</span>classId<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.NETéƒ¨&#39;</span>,<span style="color:#ff79c6">@</span>sex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;ç”·&#39;</span>
<span style="color:#ff79c6">EXEC</span> usp_GetStaffInfoBySexForClass <span style="color:#f1fa8c">&#39;.NETéƒ¨&#39;</span>,<span style="color:#f1fa8c">&#39;ç”·&#39;</span>
<span style="color:#ff79c6">EXEC</span> usp_GetStaffInfoBySexForClass <span style="color:#ff79c6">default</span>,<span style="color:#f1fa8c">&#39;.NETéƒ¨&#39;</span>    <span style="color:#6272a4">--ä¸éœ€è¦æ”¹å˜é»˜è®¤å€¼å°±æ˜¯ç”¨defaultå…³é”®å­—</span></code></pre></td></tr></table>
</div>
</div>
<p><strong>è¿”å›æŒ‡å®šæ€§åˆ«å‘˜å·¥äººæ•°å’Œæ€»äººæ•°</strong>
ã€€ã€€<code>output</code>å‚æ•°ç›¸å½“äºc#ä¸­çš„<code>out</code>å‚æ•°ï¼Œç”¨äºå°†å‚æ•°è¿”å›ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™éœ€è¦å£°æ˜å˜é‡å»æ¥æ”¶ã€‚æ³¨æ„åœ¨æ¥æ”¶çš„æ—¶å€™ï¼Œæ¥æ”¶çš„å˜é‡åä¹Ÿè¦æœ‰<code>output</code>å‚æ•°ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">go</span>
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">exists</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> sysobjects <span style="color:#ff79c6">where</span> name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;usp_GetStaffManAndStaffCount&#39;</span>)
<span style="color:#ff79c6">create</span> proc usp_GetStaffManAndStaffCount
    <span style="color:#ff79c6">@</span>sex <span style="color:#ff79c6">nchar</span>(<span style="color:#bd93f9">1</span>),
    <span style="color:#ff79c6">@</span>SexCount <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">output</span>,
    <span style="color:#ff79c6">@</span><span style="color:#ff79c6">count</span> <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">output</span>
<span style="color:#ff79c6">as</span>
    <span style="color:#ff79c6">set</span> <span style="color:#ff79c6">@</span>SexCount<span style="color:#ff79c6">=</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">from</span> Staff <span style="color:#ff79c6">where</span> Sex<span style="color:#ff79c6">=@</span>sex)
    <span style="color:#ff79c6">set</span> <span style="color:#ff79c6">@</span><span style="color:#ff79c6">count</span><span style="color:#ff79c6">=</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">from</span> Staff)


<span style="color:#6272a4">--è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">declare</span> <span style="color:#ff79c6">@</span>manCount <span style="color:#8be9fd;font-style:italic">int</span>,<span style="color:#ff79c6">@</span>sumCount <span style="color:#8be9fd;font-style:italic">int</span>
<span style="color:#ff79c6">exec</span> usp_GetStaffManAndStaffCount <span style="color:#f1fa8c">&#39;ç”·&#39;</span>,<span style="color:#ff79c6">@</span>manCount <span style="color:#ff79c6">output</span>,<span style="color:#ff79c6">@</span>sumCount <span style="color:#ff79c6">output</span></code></pre></td></tr></table>
</div>
</div>
<p>ğŸ« <strong>ä¸€ä¸ªåˆ†é¡µå­˜å‚¨è¿‡ç¨‹</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">if</span> <span style="color:#ff79c6">exists</span>(<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> sysobjects <span style="color:#ff79c6">where</span> name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;usp_pageing&#39;</span>)
    <span style="color:#ff79c6">drop</span> proc usp_pageing

<span style="color:#ff79c6">create</span> proc usp_pageing
    <span style="color:#ff79c6">@</span>totalPage <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">output</span>,   <span style="color:#6272a4">--æ€»é¡µæ•°
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">@</span>pageIndex <span style="color:#8be9fd;font-style:italic">int</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>,   <span style="color:#6272a4">--å½“å‰çš„é¡µç æ•°ï¼Œé»˜è®¤ä»1å¼€å§‹
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">@</span>pageCount <span style="color:#8be9fd;font-style:italic">int</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>   <span style="color:#6272a4">--æ¯é¡µæ˜¾ç¤ºçš„æ¡ç›®æ•°
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">as</span>
    <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> (<span style="color:#ff79c6">select</span> ROW_NUMBER() over(<span style="color:#ff79c6">order</span> <span style="color:#ff79c6">by</span> newsCreateDate) id, <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> News) item <span style="color:#ff79c6">where</span> item.Id<span style="color:#ff79c6">&gt;</span>(<span style="color:#ff79c6">@</span>pageIndex<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">*@</span>pageCount <span style="color:#ff79c6">and</span> item.Id<span style="color:#ff79c6">&lt;=</span>(<span style="color:#ff79c6">@</span>pageIndex<span style="color:#ff79c6">*@</span>pageCount)
    <span style="color:#ff79c6">set</span> <span style="color:#ff79c6">@</span>totalPage<span style="color:#ff79c6">=</span>ceiling((<span style="color:#ff79c6">select</span> <span style="color:#ff79c6">count</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">from</span> News)<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1</span>.<span style="color:#bd93f9">0</span><span style="color:#ff79c6">/@</span>pageCount)   <span style="color:#6272a4">--ceilingå‡½æ•°ä¸ºå‘ä¸Šå››èˆäº”å…¥ï¼Œå¦‚ï¼šceiling(1.45,0) = 2;ceiling(1.55,0)=2</span></code></pre></td></tr></table>
</div>
</div>
                </div>
                <div class="feat share">
                </div>

                <div id="disqus_thread"></div>
<script>
    

    

    (function() { 
        var d = document,
            s = d.createElement('script');

        s.src = 'https://HaijdBlog.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            </article>
        </section>

        <footer>
	
	<small>Haijd</small>
	
</footer>
    </div>

    <div class="next-prev-arrows">
        
        <a rel="next" href="/csharp/asp-net%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E6%93%8D%E4%BD%9C/" id="next">
                &larr; <span class="nav-title nav-title-next">ASP.NETå­˜å‚¨è¿‡ç¨‹æ“ä½œ</span> 
            </a>  
        <a rel="prev" href="/csharp/asp-net%E4%B8%AD%E7%9A%84url%E9%87%8D%E5%86%99/" id="prev">
            <span class="nav-title nav-title-prev">ASP.NETä¸­çš„Urlé‡å†™</span> &rarr;
        </a>
        
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/js/scrollreveal.min.js"></script>
<script type='application/javascript' src='/js/smooth-scrollbar.js'></script>
<script src="/js/baffle.min.js"></script>
<script src="/js/main.js"></script>
 
</body>

</html>